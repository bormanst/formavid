#!/bin/bash -e
# Copyright (C) 2018 Sean Borman <bormanst@gmail.com>.
# You should have received LICENSE.txt, a copy of the
# GNU General Public License, along with this program.
# If not, see <https://www.gnu.org/licenses/>.

# regenerate drupal8 hash_salt and mysql password

SALT=""
PASSWORD=""

CONF=/var/www/drupal8/sites/default/settings.php
sed -i "s|^\$drupal_hash_salt = \(.*\)|\$drupal_hash_salt = '${SALT}';|" $CONF
sed -i "s|^  'password'\(.*\)|  'password' => '${PASSWORD}',|" $CONF

CONF=/var/www/drupal8/sites/default/stack.settings.php
sed -i "s|^\$drupal_hash_salt = \(.*\)|\$drupal_hash_salt = '${SALT}';|" $CONF
sed -i "s|^  'password'\(.*\)|  'password' => '${PASSWORD}',|" $CONF

/usr/local/formavid-gce/bin/initialize/python/mysqlconf.py --user=drupal8 --pass="${PASSWORD}"

exit 0
