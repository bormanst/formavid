#!/bin/bash -e
# Copyright (C) 2018 Sean Borman <bormanst@gmail.com>.
# You should have received LICENSE.txt, a copy of the
# GNU General Public License, along with this program.
# If not, see <https://www.gnu.org/licenses/>.

# regenerate simpleinvoices secrets and mysql password

CONF=/var/www/simpleinvoices/config/config.ini
sed -i "s|^encryption.default.key.*|encryption.default.key = $(mcookie)|" $CONF
sed -i "s|^nonce.key.*|nonce.key = $(mcookie)|" $CONF

PASSWORD=formavid
sed -i "0,/params.password/s/params.password.*/params.password = $PASSWORD/" $CONF
${FORMAVID}/bin/initialize/python/mysqlconf.py --user=simpleinvoices --pass="$PASSWORD"

# Delete APACHE_PASSWD if exists.
APACHE_PASSWD=/usr/local/apache2/passwd/simpleinvoices
if [ -d $APACHE_PASSWD ]; then
    rm -rf $APACHE_PASSWD
fi

exit 0
