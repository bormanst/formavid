#!/bin/bash -e
# Copyright (C) 2018 Sean Borman <bormanst@gmail.com>.
# You should have received LICENSE.txt, a copy of the
# GNU General Public License, along with this program.
# If not, see <https://www.gnu.org/licenses/>.

# Create initial base site stack.

SCRIPT_DIR=${FORMAVID}/bin/initialize/python

# Requires envars.
if  [ -n "${PASSWORDS_ONLY}" ] || ([ -n "${APP_EMAIL}" ] && [ -n "${DOMAIN}" ] && [ -n "${SITETITLE}" ]); then
    # Configure base site.
    $SCRIPT_DIR/formavidbasesite.py
fi

# Requires envars.
if [ -z "${PASSWORDS_ONLY}" ]; then
    # Create initial drupal stack.
    $SCRIPT_DIR/create-drupal-stack.py

    # Prefix initial stack with aaa- so it gets hit first and differentiates it from other user created stacks.
    rm -f /etc/apache2/sites-enabled/${DOMAIN}.conf
    mv -f /etc/apache2/sites-available/${DOMAIN}.conf /etc/apache2/sites-available/aaa-${DOMAIN}.conf
    cp -sf /etc/apache2/sites-available/aaa-${DOMAIN}.conf /etc/apache2/sites-enabled/.
fi

exit 0
